within OpenRESV.RES_Model_vs_PHIL_Inverter_Examples.Irradiance2Power;
model PVPlantSolarIrradiance
  "PV source in a SMIB system to test functionality of Irradiance to Power Add on"
  extends OpenRESV.RES_Model_vs_PHIL_Inverter_Examples.BaseClasses.SMIBAddOn(SysData(fn=60), pwFault(
      R=0.4,
      X=0.4,
      t1=40000,
      t2=40000.3));
  OpenRESV.Electrical.Renewables.PSSE.PV PV(
    P_0=10,
    Q_0=3.2868,
    v_0=1,
    angle_0(displayUnit="deg") = 0,
    QFunctionality=0,
    PFunctionality=0,
    Irr2Pow=true,
    redeclare OpenRESV.Electrical.Renewables.PSSE.InverterInterface.REGCA1
      RenewableGenerator,
    redeclare OpenRESV.Electrical.Renewables.PSSE.ElectricalController.REECB1
      RenewableController(vref0=1),
    redeclare OpenRESV.Electrical.Renewables.PSSE.PlantController.REPCA1
      PlantController)
    annotation (Placement(transformation(extent={{-26,-10},{-6,10}})));
  OpenRESV.Electrical.Renewables.PSSE.AddOnBlocks.IrradianceToPower irradianceToPower(
    M_b(displayUnit="MV.A") = 100000000,
    Ypv(displayUnit="MW") = 1500000,
    Tcstc(displayUnit="degC") = 298.15,
    fpv=1,
    ap=0,
    SolarRadiationTable=[0,0; 300,0; 600,0; 900,0; 1200,0; 1500,0; 1800,0; 2100,
        0; 2400,0; 2700,0; 3000,0; 3300,0; 3600,0; 3900,0; 4200,0; 4500,0; 4800,
        0; 5100,0; 5400,0; 5700,0; 6000,0; 6300,0; 6600,0; 6900,0; 7200,0; 7500,
        0; 7800,0; 8100,0; 8400,0; 8700,0; 9000,0; 9300,0; 9600,0; 9900,0; 10200,
        0; 10500,0; 10800,0; 11100,0; 11400,0; 11700,0; 12000,0; 12300,0; 12600,
        0; 12900,0; 13200,0; 13500,0; 13800,0; 14100,0; 14400,0; 14700,0; 15000,
        0; 15300,0; 15600,0; 15900,0; 16200,7; 16500,11; 16800,16; 17100,23; 17400,
        30; 17700,39; 18000,48; 18300,58; 18600,69; 18900,80; 19200,91; 19500,103;
        19800,115; 20100,128; 20400,141; 20700,154; 21000,168; 21300,181; 21600,
        195; 21900,209; 22200,223; 22500,237; 22800,252; 23100,266; 23400,280; 23700,
        294; 24000,309; 24300,324; 24600,338; 24900,353; 25200,368; 25500,383; 25800,
        398; 26100,413; 26400,427; 26700,442; 27000,456; 27300,472; 27600,487; 27900,
        502; 28200,516; 28500,530; 28800,544; 29100,558; 29400,571; 29700,586; 30000,
        599; 30300,612; 30600,625; 30900,640; 31200,652; 31500,664; 31800,676; 32100,
        688; 32400,700; 32700,711; 33000,722; 33300,733; 33600,744; 33900,754; 34200,
        763; 34500,773; 34800,782; 35100,791; 35400,800; 35700,808; 36000,817; 36300,
        823; 36600,831; 36900,838; 37200,844; 37500,850; 37800,856; 38100,860; 38400,
        864; 38700,869; 39000,874; 39300,878; 39600,881; 39900,885; 40200,888; 40500,
        891; 40800,893; 41100,895; 41400,897; 41700,893; 42000,895; 42300,895; 42600,
        895; 42900,895; 43200,895; 43500,893; 43800,892; 44100,890; 44400,889; 44700,
        886; 45000,884; 45300,871; 45600,868; 45900,863; 46200,859; 46500,855; 46800,
        850; 47100,845; 47400,840; 47700,834; 48000,828; 48300,821; 48600,815; 48900,
        809; 49200,801; 49500,794; 49800,786; 50100,777; 50400,769; 50700,760; 51000,
        751; 51300,741; 51600,731; 51900,721; 52200,711; 52500,704; 52800,693; 53100,
        682; 53400,670; 53700,660; 54000,648; 54300,636; 54600,623; 54900,611; 55200,
        598; 55500,585; 55800,572; 56100,561; 56400,547; 56700,534; 57000,520; 57300,
        507; 57600,493; 57900,479; 58200,465; 58500,451; 58800,436; 59100,422; 59400,
        407; 59700,394; 60000,380; 60300,365; 60600,351; 60900,336; 61200,321; 61500,
        307; 61800,292; 62100,278; 62400,263; 62700,249; 63000,235; 63300,223; 63600,
        209; 63900,195; 64200,181; 64500,168; 64800,155; 65100,142; 65400,129; 65700,
        116; 66000,104; 66300,92; 66600,81; 66900,71; 67200,61; 67500,51; 67800,
        41; 68100,33; 68400,25; 68700,18; 69000,12; 69300,8; 69600,0; 69900,0; 70200,
        0; 70500,0; 70800,0; 71100,0; 71400,0; 71700,0; 72000,0; 72300,0; 72600,
        0; 72900,0; 73200,0; 73500,0; 73800,0; 74100,0; 74400,0; 74700,0; 75000,
        0; 75300,0; 75600,0; 75900,0; 76200,0; 76500,0; 76800,0; 77100,0; 77400,
        0; 77700,0; 78000,0; 78300,0; 78600,0; 78900,0; 79200,0; 79500,0; 79800,
        0; 80100,0; 80400,0; 80700,0; 81000,0; 81300,0; 81600,0; 81900,0; 82200,
        0; 82500,0; 82800,0; 83100,0; 83400,0; 83700,0; 84000,0; 84300,0; 84600,
        0; 84900,0; 85200,0; 85500,0; 85800,0; 86100,0; 86400,0],
    SolarArrayTemperatureTable=[0,19.6; 300,19.6; 600,19.6; 900,19.6; 1200,19.6;
        1500,19.5; 1800,19.5; 2100,19.5; 2400,19.5; 2700,19.5; 3000,19.4; 3300,19.4;
        3600,19.4; 3900,19.4; 4200,19.3; 4500,19.3; 4800,19.3; 5100,19.2; 5400,19.2;
        5700,19.2; 6000,19.1; 6300,19.1; 6600,19.1; 6900,19; 7200,19; 7500,18.9;
        7800,18.9; 8100,18.8; 8400,18.7; 8700,18.7; 9000,18.6; 9300,18.5; 9600,18.5;
        9900,18.4; 10200,18.3; 10500,18.3; 10800,18.2; 11100,18.2; 11400,18.1; 11700,
        18; 12000,18; 12300,17.9; 12600,17.9; 12900,17.8; 13200,17.8; 13500,17.7;
        13800,17.7; 14100,17.6; 14400,17.5; 14700,17.5; 15000,17.5; 15300,17.5;
        15600,17.4; 15900,17.4; 16200,17.4; 16500,17.3; 16800,17.3; 17100,17.3;
        17400,17.3; 17700,17.2; 18000,17.2; 18300,17.2; 18600,17.2; 18900,17.2;
        19200,17.2; 19500,17.1; 19800,17.1; 20100,17.1; 20400,17.1; 20700,17.1;
        21000,17.1; 21300,17.1; 21600,17.1; 21900,17.1; 22200,17.1; 22500,17.1;
        22800,17.1; 23100,17.1; 23400,17.1; 23700,17.1; 24000,17.1; 24300,17.1;
        24600,17.2; 24900,17.2; 25200,17.2; 25500,17.2; 25800,17.2; 26100,17.3;
        26400,17.3; 26700,17.3; 27000,17.4; 27300,17.4; 27600,17.4; 27900,17.4;
        28200,17.5; 28500,17.5; 28800,17.5; 29100,17.6; 29400,17.7; 29700,17.7;
        30000,17.8; 30300,17.9; 30600,18; 30900,18; 31200,18.1; 31500,18.2; 31800,
        18.3; 32100,18.3; 32400,18.4; 32700,18.5; 33000,18.5; 33300,18.6; 33600,
        18.7; 33900,18.8; 34200,18.8; 34500,18.9; 34800,19; 35100,19; 35400,19.1;
        35700,19.2; 36000,19.2; 36300,19.3; 36600,19.3; 36900,19.4; 37200,19.5;
        37500,19.5; 37800,19.6; 38100,19.6; 38400,19.7; 38700,19.7; 39000,19.8;
        39300,19.8; 39600,19.9; 39900,19.9; 40200,20; 40500,20.1; 40800,20.2; 41100,
        20.3; 41400,20.4; 41700,20.4; 42000,20.5; 42300,20.6; 42600,20.7; 42900,
        20.8; 43200,20.9; 43500,20.8; 43800,20.8; 44100,20.8; 44400,20.8; 44700,
        20.7; 45000,20.7; 45300,20.7; 45600,20.7; 45900,20.6; 46200,20.6; 46500,
        20.6; 46800,20.5; 47100,20.5; 47400,20.4; 47700,20.3; 48000,20.3; 48300,
        20.2; 48600,20.1; 48900,20.1; 49200,20; 49500,19.9; 49800,19.9; 50100,19.8;
        50400,19.7; 50700,19.7; 51000,19.7; 51300,19.6; 51600,19.6; 51900,19.5;
        52200,19.5; 52500,19.5; 52800,19.4; 53100,19.4; 53400,19.4; 53700,19.3;
        54000,19.3; 54300,19.3; 54600,19.2; 54900,19.2; 55200,19.2; 55500,19.2;
        55800,19.1; 56100,19.1; 56400,19.1; 56700,19; 57000,19; 57300,19; 57600,
        19; 57900,18.9; 58200,18.9; 58500,18.9; 58800,18.8; 59100,18.8; 59400,18.8;
        59700,18.8; 60000,18.7; 60300,18.7; 60600,18.7; 60900,18.6; 61200,18.6;
        61500,18.6; 61800,18.5; 62100,18.5; 62400,18.4; 62700,18.4; 63000,18.3;
        63300,18.3; 63600,18.2; 63900,18.2; 64200,18.1; 64500,18.1; 64800,18.1;
        65100,18; 65400,18; 65700,17.9; 66000,17.9; 66300,17.8; 66600,17.8; 66900,
        17.8; 67200,17.7; 67500,17.7; 67800,17.6; 68100,17.6; 68400,17.6; 68700,
        17.5; 69000,17.5; 69300,17.5; 69600,17.5; 69900,17.4; 70200,17.4; 70500,
        17.4; 70800,17.4; 71100,17.4; 71400,17.3; 71700,17.3; 72000,17.3; 72300,
        17.3; 72600,17.3; 72900,17.3; 73200,17.2; 73500,17.2; 73800,17.2; 74100,
        17.2; 74400,17.2; 74700,17.2; 75000,17.2; 75300,17.2; 75600,17.1; 75900,
        17.1; 76200,17.1; 76500,17.1; 76800,17.1; 77100,17.1; 77400,17; 77700,17;
        78000,17; 78300,17; 78600,17; 78900,17; 79200,17; 79500,16.9; 79800,16.9;
        80100,16.9; 80400,16.9; 80700,16.9; 81000,16.9; 81300,16.9; 81600,16.9;
        81900,16.9; 82200,16.9; 82500,16.9; 82800,16.9; 83100,16.9; 83400,16.9;
        83700,16.9; 84000,16.9; 84300,16.9; 84600,16.9; 84900,16.9; 85200,16.9;
        85500,16.9; 85800,16.9; 86100,16.9; 86400,16.9])
    annotation (Placement(transformation(extent={{-88,-2},{-68,18}})));
  OpenRESV.Electrical.WhiteNoiseInjection whiteNoiseInjection(
      active_sigma=0.0001, samplePeriod=10)
    annotation (Placement(transformation(extent={{-86,-26},{-70,-10}})));
  Modelica.Blocks.Math.Add add
    annotation (Placement(transformation(extent={{-56,-2},{-44,10}})));
  inner Modelica.Blocks.Noise.GlobalSeed globalSeed(
    useAutomaticSeed=false,
    enableNoise=true,
    fixedSeed=10000)
    annotation (Placement(transformation(extent={{-40,60},{-20,80}})));
  Modelica.Clocked.RealSignals.Sampler.Utilities.Internal.Limiter limiter(uMax=
        1000000000, uMin=0)
    annotation (Placement(transformation(extent={{-64,-22},{-56,-14}})));
equation
  connect(PV.pwPin, PV_BUS.p)
    annotation (Line(points={{-6,0},{0,0}}, color={0,0,255}));
  connect(add.y, PV.i2p)
    annotation (Line(points={{-43.4,4},{-28,4}}, color={0,0,127}));
  connect(irradianceToPower.Ppv, add.u1)
    annotation (Line(points={{-67,8},{-66,7.6},{-57.2,7.6}}, color={0,0,127}));
  connect(whiteNoiseInjection.y, limiter.u) annotation (Line(points={{-69.28,
          -18.08},{-70,-18},{-64.8,-18}}, color={0,0,127}));
  connect(limiter.y, add.u2) annotation (Line(points={{-55.6,-18},{-50,-18},{
          -50,-8},{-64,-8},{-64,0.4},{-57.2,0.4}}, color={0,0,127}));
  annotation (experiment(
      StopTime=86400,
      __Dymola_NumberOfIntervals=500000,
      __Dymola_Algorithm="Dassl"), Documentation(info="<html>
<p>
Simulate for 5 seconds.
</p>
<p>This test system aims to show how to use IrradianceToPower block, an Add-On component that enables varying active power reference in the PV model based on irradiance levels. 
This capability is not found in the original version of the WECC-based renewable models.</p>
<p>Variables of interest:</p>
<ul>
<li><code>pV.RenewableGenerator.Pgen</code></li>
<li><code>pV.RenewableGenerator.Qgen</code></li>
<li><code>irradianceToPower.Ppv</code></li>
</ul>
</html>"),
    Diagram(coordinateSystem(extent={{-100,-100},{100,100}}), graphics={Text(
          extent={{-90,-28},{-66,-34}},
          textColor={0,0,0},
          textString="Noise"), Text(
          extent={{-40,12},{-24,6}},
          textColor={0,0,0},
          textString="Pinput")}),
    Icon(coordinateSystem(extent={{-100,-100},{120,100}})));
end PVPlantSolarIrradiance;
